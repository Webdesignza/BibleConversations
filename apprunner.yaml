# ============================================================================
# AWS App Runner Configuration
# Optimized for Bible Conversations deployment
# ============================================================================

version: 1.0
runtime: python311

build:
  commands:
    build:
      - echo "Building Bible Conversations for App Runner..."
      - pip install --no-cache-dir -r requirements.txt
      - echo "Build complete!"

run:
  runtime-version: 3.11
  command: uvicorn app.main:app --host 0.0.0.0 --port 8080 --workers 1
  network:
    port: 8080
    env: 
      - name: PORT
        value: "8080"
  env:
    - name: PYTHONUNBUFFERED
      value: "1"
    - name: PYTHONDONTWRITEBYTECODE
      value: "1"

# Health check configuration
health-check:
  protocol: http
  path: /health
  interval: 20
  timeout: 5
  healthy-threshold: 1
  unhealthy-threshold: 5

# Auto scaling configuration (cost optimized)
instance-configuration:
  cpu: 0.25 vcpu          # Minimum for cost savings
  memory: 0.5 GB          # Sufficient for FastAPI + ChromaDB
  instance-role-arn: ""   # Will be created during setup

# Observability
observability-configuration:
  tracing-vendor: awsxray